# CPU1 結合テスト（Step A）

## 1. 概要
　作成中の RV32I ベース CPU（以下 CPU1）に対して実施した  
**結合テスト（Step A）** の内容および結果をまとめた。

本結合テストは、CPU1 を構成する各モジュールが正しく接続され、  
CPU として一連の処理が成立していることを確認することを目的としている。

なお、結合状態の確認（動作確認）** のみを扱える。

---

## 2. 結合テストの目的
本結合テストでは、以下の点を確認することを目的とした。

- 命令メモリ、レジスタファイル、ALU、データメモリ等の各モジュールが  
  CPU1 内で正しく接続されていること
- 命令フェッチ → デコード → 実行 → メモリアクセス → 書き戻し  
  という CPU の基本的な処理の流れが成立していること
- 想定した命令列の実行結果が、  
  レジスタおよびデータメモリに正しく反映されること

mem_cpu1_stepA.binは今回の結合テストのバイナリ表示です。アセンブリ表示は以下になります。

```
0x00: lw   x1, 0(x0)        # Read constant 0x11223344 from mem[0]
0x04: sw   x1, 4(x0)        # Write to mem[4]
0x08: lw   x2, 4(x0)        # Read back from mem[4]
0x0C: beq  x1, x2, +16      # Compare: if equal → PASS path
0x10: addi x3, x0, 0        # FAIL: x3 = 0
0x14: sw   x3, 8(x0)        # Write 0 to mem[8]
0x18: jal  x0, +12          # Jump to END
0x1C: addi x3, x0, 1        # PASS: x3 = 1
0x20: sw   x3, 8(x0)        # Write 1 to mem[8]
0x24: jal  x0, 0            # END: infinite loop
```

## **パスになるための条件**: `mem[8] == 32'h1` 200　サイクル後 

---

## 3. テスト構成

### 3.1 使用した主なファイル
本結合テストでは、以下のファイルを使用した。

- `rv32i.v`  
  CPU1 本体（命令実行の中核となるモジュール）

- `reg.v`  
  レジスタファイルモジュール

- `i_mem.v`  
  命令メモリモジュール

- `d_mem.v`  
  データメモリモジュール

- `tb_cpu1_stepA.v`  
  CPU1 全体を対象とした結合テスト用テストベンチ

- `tb_cpu1_stepA_debug.v`  
  内部状態の確認を目的としたデバッグ用テストベンチ(trace_outputの出力と無限ループ回避を追加した修正版みたいなものです。)

- `data_cpu1_stepA.dat`  
  データメモリ初期化用ファイル

---

## 4. テスト内容
テストベンチでは、あらかじめ用意した命令列を CPU1 に実行させ、  
実行後のレジスタおよびデータメモリの状態を確認している。

テスト中は、CPU1 内部の処理が想定通りに進んでいるかを確認し、  
最終的な結果が期待値と一致するかを検証した。

また、デバッグ用テストベンチを用いることで、  
必要に応じて内部状態の追跡が可能な構成としている。

---

## 5. テスト結果
結合テストの結果、以下の点を確認した。

- 想定した命令列が正しく実行されたこと
- 実行後のレジスタおよびデータメモリの内容が期待値と一致したこと
- テストベンチによるチェックがすべて **PASS** となったこと

シミュレーション実行時のログは  
`trace_output.txt` に出力されており、  
PASS 判定を含む実行結果を確認できる。

---

## 6. 確認方法
結合テストの結果は、以下の方法で確認できる。
波形から一部の確認として画像をおいています。あれだけは分かりにくいと思うので、GTKWaveから参照いただければ幸いです。

- 実行結果の概要確認  
  → `trace_output.txt` を参照

- 内部挙動の詳細確認  
  → `tb_cpu1_stepA_debug.v` を使用

---

## 7. 補足
本資料は、CPU1 が結合状態として正しく動作していることを確認した結果を示すものである。  
今後の機能追加や拡張については、本結合テストの範囲外とする。今後展望の中にあるファイルは今回無視しておいてください。